# Tower Dungeon

3D ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼RPGï¼ˆThree.jsè£½ï¼‰+ AIè‡ªå‹•ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

[English version below](#english)

---

## ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `index.html` ã‚’é–‹ãã ã‘ã§ãƒ—ãƒ¬ã‚¤å¯èƒ½ã§ã™ã€‚

## éŠã³æ–¹

### æ“ä½œæ–¹æ³•

| ã‚­ãƒ¼ | å‹•ä½œ |
|------|------|
| **WASD** | ç§»å‹• |
| **ãƒã‚¦ã‚¹** | è¦–ç‚¹æ“ä½œ |
| **ã‚¯ãƒªãƒƒã‚¯** | æ”»æ’ƒï¼ˆMP5æ¶ˆè²»ï¼‰ |
| **E** | ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒˆï¼ˆãƒœã‚¹èµ·å‹•ã€ç¥ ä½¿ç”¨ã€éšæ®µæ˜‡é™ã€ãƒ‰ã‚¢ã‚’é–‹ã‘ã‚‹ï¼‰ |
| **TAB** | ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚’é–‹ã |
| **ESC** | ãƒã‚¦ã‚¹ãƒ•ã‚©ãƒ¼ã‚«ã‚¹è§£é™¤ / ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚’é–‰ã˜ã‚‹ |

### ã‚²ãƒ¼ãƒ ã®æµã‚Œ

1. ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚’æ¢ç´¢ã—ã¦**ãƒœã‚¹ã‚­ãƒ¼(ğŸ”‘)**ã‚’è¦‹ã¤ã‘ã‚‹
2. ãƒœã‚¹éƒ¨å±‹ã«è¡Œãã€**E**ã‚­ãƒ¼ã§ãƒœã‚¹ã‚’èµ·å‹•
3. ãƒœã‚¹ã‚’å€’ã™ã¨**éšæ®µ**ãŒå‡ºç¾
4. éšæ®µã‚’ä½¿ã£ã¦æ¬¡ã®ãƒ•ãƒ­ã‚¢ã¸

### ã‚¢ã‚¤ãƒ†ãƒ 

TABã‚­ãƒ¼ã§ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚’é–‹ãã€ã‚¯ãƒªãƒƒã‚¯ã§ä½¿ç”¨ã—ã¾ã™ã€‚

| ã‚¢ã‚¤ã‚³ãƒ³ | åå‰ | åŠ¹æœ |
|----------|------|------|
| ğŸ§ª | Potion | HP50å›å¾© |
| ğŸ’§ | MP Potion | MP30å›å¾© |
| ğŸ›¡ï¸ | Shield | ATKæ°¸ç¶š+3 |
| âœ¨ | Charm | 15ç§’é–“è¢«ãƒ€ãƒ¡ãƒ¼ã‚¸50%æ¸› |
| ğŸ”¥ | Torch | 60ç§’é–“è¦–ç•Œã‚’åºƒã’ã‚‹ |

### æ¾æ˜ã‚·ã‚¹ãƒ†ãƒ 

ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã¯éå¸¸ã«æš—ãã€æ¾æ˜ãªã—ã§ã¯**1ãƒã‚¹å…ˆ**ã—ã‹è¦‹ãˆã¾ã›ã‚“ã€‚

- å„ãƒ•ãƒ­ã‚¢ã«å¿…ãš1ã¤æ¾æ˜ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹
- TABã§ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚’é–‹ã„ã¦ä½¿ç”¨
- 60ç§’é–“æœ‰åŠ¹ï¼ˆãƒ•ãƒ­ã‚¢ç§»å‹•ã—ã¦ã‚‚ç¶™ç¶šï¼‰
- æ¾æ˜ã‚’è¦‹ã¤ã‘ã¦ä½¿ã†ã¾ã§ã¯æ…é‡ã«æ¢ç´¢ã—ã‚ˆã†ï¼

---

## æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ 

### ãƒ†ãƒ¬ã‚°ãƒ©ãƒ•å›é¿

ãƒœã‚¹ã¯**é€šå¸¸æ”»æ’ƒ3å›ã”ã¨**ã«å¼·åŠ›ãªç‰¹æ®Šæ”»æ’ƒã‚’ãƒãƒ£ãƒ¼ã‚¸ã—ã¾ã™ã€‚

- ãƒœã‚¹ãŒ**èµ¤ãç‚¹æ»…**ã—ã€ç”»é¢ã«è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹
- ãƒãƒ£ãƒ¼ã‚¸ä¸­ã«**è·é›¢6ä»¥ä¸Š**é›¢ã‚Œã‚‹ã¨å›é¿æˆåŠŸï¼ˆã€ŒDODGE!ã€è¡¨ç¤ºï¼‰
- å›é¿å¤±æ•—ã§**é€šå¸¸ã®3å€ãƒ€ãƒ¡ãƒ¼ã‚¸**

### ãƒãƒƒã‚¯ã‚¹ã‚¿ãƒ–

ãƒœã‚¹ã®**èƒŒå¾Œï¼ˆÂ±60Â°ï¼‰**ã‹ã‚‰æ”»æ’ƒã™ã‚‹ã¨**ãƒ€ãƒ¡ãƒ¼ã‚¸2å€**ã«ãªã‚Šã¾ã™ã€‚

- ã€ŒBACKSTAB!ã€ã¨é»„è‰²ãè¡¨ç¤º
- ãƒœã‚¹ã®æ—‹å›é€Ÿåº¦ã¯åˆ¶é™ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€æ¨ªã«å›ã‚Šè¾¼ã‚“ã§èƒŒå¾Œã‚’ç‹™ãˆã‚‹

### ã‚³ãƒ³ãƒœã‚·ã‚¹ãƒ†ãƒ 

**2ç§’ä»¥å†…**ã«é€£ç¶šæ”»æ’ƒã‚’å½“ã¦ã‚‹ã¨ã‚³ãƒ³ãƒœãŒåŠ ç®—ã•ã‚Œã¾ã™ã€‚

| ã‚³ãƒ³ãƒœæ•° | ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒœãƒ¼ãƒŠã‚¹ |
|----------|------------------|
| 1 | +0% |
| 2 | +15% |
| 3 | +30% |
| 4 | +45% |
| 5 | +75%ï¼ˆæœ€å¤§ï¼‰ |

### ç¥ ï¼ˆShrineï¼‰

ãƒãƒƒãƒ—ä¸Šã«ã‚ã‚‹ç¥ ã‚’**E**ã‚­ãƒ¼ã§ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ•ãƒ­ã‚¢ä¸­æœ‰åŠ¹ãªãƒãƒ•ã‚’ç²å¾—ã§ãã¾ã™ã€‚

- **ATK +5**
- **MaxHP +20**

ãƒœã‚¹æˆ¦å‰ã«è¦‹ã¤ã‘ã‚‹ã¨æœ‰åˆ©ã«æˆ¦ãˆã¾ã™ã€‚

---

## æ•µã®ç¨®é¡

### é€šå¸¸ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼

| ã‚¿ã‚¤ãƒ— | ç‰¹å¾´ |
|--------|------|
| **Skeleton** | æ¨™æº–çš„ãªæ•µ |
| **Slime** | æ­»äº¡æ™‚ã«2ä½“ã«åˆ†è£‚ |
| **Wraith** | å£ã‚’ã™ã‚ŠæŠœã‘ã‚‹ã€é«˜æ”»æ’ƒåŠ› |
| **Golem** | é«˜HPãƒ»é«˜æ”»æ’ƒåŠ›ã€ç§»å‹•ãŒé…ã„ |

### ãƒœã‚¹

| ã‚¿ã‚¤ãƒ— | ç‰¹æ®Šæ”»æ’ƒ | å¯¾ç­– |
|--------|----------|------|
| **Guardian** | ç¯„å›²ã‚¹ãƒ©ãƒ æ”»æ’ƒ | ãƒãƒ£ãƒ¼ã‚¸ä¸­ã«è·é›¢ã‚’å–ã‚‹ |
| **Sorcerer** | å¼¾å¹• + ãƒ†ãƒ¬ãƒãƒ¼ãƒˆ | å¼¾ã‚’æ¨ªç§»å‹•ã§å›é¿ |
| **Berserker** | çªé€²æ”»æ’ƒï¼ˆå£ã§2ç§’ã‚¹ã‚¿ãƒ³ï¼‰ã€HP30%ä»¥ä¸‹ã§ç‹‚æš´åŒ– | ã‚¹ã‚¿ãƒ³ä¸­ã«ãƒãƒƒã‚¯ã‚¹ã‚¿ãƒ– |

---

## è‡ªå‹•ãƒ†ã‚¹ãƒˆ

Puppeteerã‚’ä½¿ã£ãŸAIè‡ªå‹•ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
npm install
```

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€3ãƒ•ãƒ­ã‚¢ï¼‰
npm test

# GUIãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤ºï¼‰
npm run test:gui

# ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆï¼ˆ1ãƒ•ãƒ­ã‚¢ã€60ç§’ï¼‰
npm run test:quick
```

### ãƒ†ã‚¹ãƒˆçµæœ

ãƒ†ã‚¹ãƒˆçµæœã¯ `test-results/` ã«å‡ºåŠ›ã•ã‚Œã¾ã™ï¼š
- `report.html` â€” HTMLãƒ¬ãƒãƒ¼ãƒˆ
- `results.json` â€” JSONå½¢å¼ã®çµæœ
- `screenshots/` â€” ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ

---

## æŠ€è¡“ä»•æ§˜

- **Three.js r128** â€” 3Dãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- **å˜ä¸€HTMLãƒ•ã‚¡ã‚¤ãƒ«** â€” ä¾å­˜ãªã—ã§ãƒ–ãƒ©ã‚¦ã‚¶ã§å³ãƒ—ãƒ¬ã‚¤å¯èƒ½
- **A*ãƒ‘ã‚¹ãƒ•ã‚¡ã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°** â€” ãƒœãƒƒãƒˆAIã®çµŒè·¯æ¢ç´¢
- **å£éš£æ¥ãƒšãƒŠãƒ«ãƒ†ã‚£** â€” ã‚³ãƒ¼ãƒŠãƒ¼ã‚¹ã‚¿ãƒƒã‚¯é˜²æ­¢
- **ãƒ•ã‚©ã‚°ã‚ªãƒ–ã‚¦ã‚©ãƒ¼** â€” æ¢ç´¢æ¸ˆã¿ã‚¨ãƒªã‚¢ã®ã¿è¡¨ç¤ºã€æœªè¨ªå•ã‚¨ãƒªã‚¢ã¯è¨˜æ†¶æ¸›è¡°

---

<a name="english"></a>

# Tower Dungeon (English)

3D Dungeon Crawler RPG built with Three.js + AI Auto-Testing Framework

---

## How to Play

Simply open `index.html` in your browser.

### Controls

| Key | Action |
|-----|--------|
| **WASD** | Move |
| **Mouse** | Look around |
| **Click** | Attack (costs 5 MP) |
| **E** | Interact (activate boss, use shrine, climb stairs, open doors) |
| **TAB** | Open inventory |
| **ESC** | Release mouse focus / Close inventory |

### Game Flow

1. Explore the dungeon and find the **Boss Key (ğŸ”‘)**
2. Go to the boss room and press **E** to activate the boss
3. Defeat the boss to reveal the **stairs**
4. Use the stairs to ascend to the next floor

### Items

Press TAB to open inventory, click to use.

| Icon | Name | Effect |
|------|------|--------|
| ğŸ§ª | Potion | Restore 50 HP |
| ğŸ’§ | MP Potion | Restore 30 MP |
| ğŸ›¡ï¸ | Shield | Permanently +3 ATK |
| âœ¨ | Charm | 50% damage reduction for 15s |
| ğŸ”¥ | Torch | Expands vision for 60s |

### Torch System

The dungeon is very dark â€” without a torch, you can only see **1 tile ahead**.

- Each floor has at least one torch
- Open inventory with TAB to use
- Lasts 60 seconds (persists through floor changes)
- Find and light a torch before exploring!

---

## Combat System

### Telegraph Dodge

Bosses charge a powerful special attack **every 3 normal attacks**.

- Boss **flashes red** with an on-screen warning
- Move **6+ units away** during charge to dodge ("DODGE!" displayed)
- Getting hit deals **3x normal damage**

### Backstab

Attack from **behind the boss (Â±60Â°)** for **2x damage**.

- "BACKSTAB!" displayed in yellow
- Boss turn rate is limited, so circle around to get behind

### Combo System

Land consecutive hits **within 2 seconds** to build combo.

| Combo | Damage Bonus |
|-------|--------------|
| 1 | +0% |
| 2 | +15% |
| 3 | +30% |
| 4 | +45% |
| 5 | +75% (max) |

### Shrine

Use shrines with **E** key to gain floor-wide buffs:

- **ATK +5**
- **MaxHP +20**

Finding the shrine before the boss fight gives you an advantage.

---

## Enemy Types

### Regular Monsters

| Type | Trait |
|------|-------|
| **Skeleton** | Standard enemy |
| **Slime** | Splits into 2 on death |
| **Wraith** | Phases through walls, high attack |
| **Golem** | High HP/attack, slow movement |

### Bosses

| Type | Special Attack | Counter |
|------|----------------|---------|
| **Guardian** | Area slam | Keep distance during charge |
| **Sorcerer** | Projectiles + teleport | Strafe to dodge bullets |
| **Berserker** | Charge attack (2s stun on wall), enrages below 30% HP | Backstab during stun |

---

## Auto Testing

Includes a Puppeteer-based AI auto-testing framework.

### Setup

```bash
npm install
```

### Run Tests

```bash
# Headless mode (default, 3 floors)
npm test

# GUI mode (visible browser)
npm run test:gui

# Quick test (1 floor, 60 seconds)
npm run test:quick
```

### Test Results

Results are saved to `test-results/`:
- `report.html` â€” HTML report
- `results.json` â€” JSON results
- `screenshots/` â€” Screenshots

---

## Technical Specs

- **Three.js r128** â€” 3D rendering
- **Single HTML file** â€” No dependencies, plays instantly in browser
- **A* Pathfinding** â€” Bot AI navigation
- **Wall-adjacency penalty** â€” Prevents corner stacking
- **Fog of War** â€” Only explored areas visible, unvisited areas fade from memory

---

## License

MIT
